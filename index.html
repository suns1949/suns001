<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>专业性格测试系统 | 心理学分析</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/docx/7.1.0/docx.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
    }
    
    :root {
      --primary: #6a5acd;
      --secondary: #9370db;
      --accent: #ff7a8a;
      --light: #f8f9ff;
      --dark: #2c3e50;
      --success: #27ae60;
      --info: #3498db;
      --warning: #f39c12;
      --gradient: linear-gradient(135deg, var(--primary), var(--secondary));
    }
    
    body {
      background: linear-gradient(135deg, #e0e7ff 0%, #d1d9ff 100%);
      color: var(--dark);
      line-height: 1.6;
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 1000px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
      overflow: hidden;
      position: relative;
    }
    
    header {
      background: var(--gradient);
      color: white;
      padding: 40px 30px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }
    
    header::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 6px;
      background: linear-gradient(90deg, var(--accent), #ffd166, var(--accent));
      animation: rainbow 3s linear infinite;
    }
    
    @keyframes rainbow {
      0% { background-position: 0% 50%; }
      100% { background-position: 100% 50%; }
    }
    
    h1 {
      font-size: 2.8rem;
      margin-bottom: 15px;
      text-shadow: 0 2px 8px rgba(0,0,0,0.2);
      letter-spacing: 1px;
    }
    
    h2 {
      font-size: 2rem;
      margin-bottom: 20px;
      color: var(--primary);
      position: relative;
      display: inline-block;
    }
    
    h2::after {
      content: "";
      position: absolute;
      bottom: -8px;
      left: 0;
      width: 60px;
      height: 4px;
      background: var(--accent);
      border-radius: 2px;
    }
    
    h3 {
      font-size: 1.5rem;
      margin: 25px 0 15px;
      color: var(--secondary);
      padding-left: 15px;
      border-left: 4px solid var(--accent);
    }
    
    p {
      margin-bottom: 20px;
      font-size: 1.1rem;
      color: #444;
    }
    
    .intro-text {
      background: rgba(255, 255, 255, 0.25);
      padding: 20px;
      border-radius: 15px;
      margin: 25px 0;
      backdrop-filter: blur(8px);
      max-width: 800px;
      margin: 25px auto;
    }
    
    #test-options {
      padding: 40px 30px;
      text-align: center;
    }
    
    .options-container {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin: 40px 0;
      flex-wrap: wrap;
    }
    
    .option-card {
      background: white;
      border-radius: 15px;
      width: 280px;
      padding: 30px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
      transition: all 0.4s ease;
      cursor: pointer;
      border: 2px solid transparent;
    }
    
    .option-card:hover {
      transform: translateY(-10px);
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.15);
      border-color: var(--primary);
    }
    
    .option-card h3 {
      font-size: 1.6rem;
      margin: 15px 0;
      color: var(--primary);
      border: none;
      padding: 0;
    }
    
    .option-card .icon {
      width: 80px;
      height: 80px;
      background: var(--gradient);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto;
      font-size: 32px;
    }
    
    .option-card ul {
      text-align: left;
      margin: 20px 0;
      padding-left: 20px;
    }
    
    .option-card li {
      margin-bottom: 12px;
      color: #555;
    }
    
    .progress-container {
      padding: 20px 30px;
      background: #f8f9ff;
      border-bottom: 1px solid #e0e0ff;
    }
    
    .progress-bar {
      height: 10px;
      background: #e0e0ff;
      border-radius: 5px;
      overflow: hidden;
      position: relative;
    }
    
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--accent), #ff9a9e);
      border-radius: 5px;
      width: 0%;
      transition: width 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
    }
    
    .progress-info {
      display: flex;
      justify-content: space-between;
      margin-top: 15px;
      font-size: 1.05rem;
      color: var(--dark);
    }
    
    .timer {
      background: rgba(106, 90, 205, 0.1);
      padding: 8px 15px;
      border-radius: 30px;
      font-weight: 600;
      color: var(--primary);
    }
    
    .question-container {
      padding: 25px 30px;
    }
    
    .question {
      background: linear-gradient(to right, #f8f9ff, #f0f3ff);
      border-radius: 15px;
      padding: 25px;
      margin-bottom: 25px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      border: 1px solid #eaeaff;
      transition: transform 0.4s ease, box-shadow 0.4s ease;
    }
    
    .question:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
    }
    
    .question p {
      font-weight: 600;
      margin-bottom: 20px;
      font-size: 1.25rem;
      color: var(--dark);
    }
    
    .options {
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    .option {
      display: flex;
      align-items: center;
      padding: 15px 20px;
      background: white;
      border-radius: 12px;
      cursor: pointer;
      border: 2px solid #e0e0ff;
      transition: all 0.3s ease;
    }
    
    .option:hover {
      border-color: var(--secondary);
      background: #f5f7ff;
    }
    
    .option.selected {
      border-color: var(--primary);
      background: #edf0ff;
      box-shadow: 0 0 0 4px rgba(106, 90, 205, 0.15);
    }
    
    .option input {
      margin-right: 15px;
      width: 20px;
      height: 20px;
      cursor: pointer;
    }
    
    .option label {
      cursor: pointer;
      font-size: 1.1rem;
      flex: 1;
      color: #444;
    }
    
    button {
      background: var(--gradient);
      color: white;
      border: none;
      padding: 16px 32px;
      font-size: 1.15rem;
      font-weight: 600;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: block;
      width: 100%;
      max-width: 320px;
      margin: 25px auto;
      box-shadow: 0 5px 20px rgba(106, 90, 205, 0.35);
      position: relative;
      overflow: hidden;
    }
    
    button::after {
      content: "";
      position: absolute;
      top: -50%;
      left: -60%;
      width: 40px;
      height: 200%;
      background: rgba(255, 255, 255, 0.3);
      transform: rotate(25deg);
      transition: all 0.6s;
    }
    
    button:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(106, 90, 205, 0.5);
    }
    
    button:hover::after {
      left: 120%;
    }
    
    button:active {
      transform: translateY(2px);
    }
    
    button.secondary {
      background: white;
      color: var(--primary);
      border: 2px solid var(--primary);
      box-shadow: 0 4px 15px rgba(106, 90, 205, 0.15);
    }
    
    button.secondary:hover {
      background: #f5f7ff;
    }
    
    .page {
      padding: 40px 30px;
      text-align: center;
      animation: fadeIn 0.6s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .hidden {
      display: none;
    }
    
    .payment-options {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin: 40px 0;
      flex-wrap: wrap;
    }
    
    .payment-btn {
      width: 180px;
      height: 180px;
      border-radius: 18px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: white;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
      cursor: pointer;
      transition: all 0.4s ease;
      position: relative;
      overflow: hidden;
    }
    
    .payment-btn::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 5px;
    }
    
    .payment-btn:hover {
      transform: translateY(-8px);
      box-shadow: 0 12px 30px rgba(0, 0, 0, 0.18);
    }
    
    .payment-btn i {
      font-size: 60px;
      margin-bottom: 20px;
      transition: transform 0.3s ease;
    }
    
    .payment-btn:hover i {
      transform: scale(1.1);
    }
    
    .wechat {
      color: #09bb07;
      border: 2px solid #09bb07;
    }
    
    .wechat::before {
      background: #09bb07;
    }
    
    .alipay {
      color: #1677ff;
      border: 2px solid #1677ff;
    }
    
    .alipay::before {
      background: #1677ff;
    }
    
    /* 支付二维码样式 */
    .qrcode-container {
      margin: 30px auto;
      background: white;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      max-width: 300px;
    }
    
    .qrcode-title {
      font-size: 1.2rem;
      margin-bottom: 15px;
      color: var(--primary);
    }
    
    .qrcode-image {
      width: 100%;
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 15px;
    }
    
    .qrcode-image img {
      width: 100%;
      display: block;
    }
    
    .qrcode-instruction {
      font-size: 0.9rem;
      color: #666;
      margin-top: 10px;
    }
    
    .payment-complete {
      margin-top: 25px;
    }
    
    /* 结果页面 */
    .result-header {
      background: var(--gradient);
      color: white;
      padding: 25px;
      border-radius: 15px;
      margin-bottom: 30px;
      position: relative;
      overflow: hidden;
    }
    
    .result-header::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 5px;
      background: linear-gradient(90deg, var(--accent), #ffd166, var(--accent));
    }
    
    .personality-card {
      background: linear-gradient(135deg, #f8f9ff, #f0f3ff);
      border-radius: 18px;
      padding: 30px;
      margin: 35px 0;
      text-align: left;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.08);
      border-left: 6px solid var(--primary);
      position: relative;
    }
    
    .personality-card::after {
      content: "";
      position: absolute;
      top: 0;
      right: 0;
      width: 100px;
      height: 100px;
      background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%236a5acd" opacity="0.1"><path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/></svg>');
      background-size: contain;
      background-repeat: no-repeat;
      opacity: 0.1;
      z-index: 0;
    }
    
    .personality-type {
      font-size: 3rem;
      font-weight: bold;
      color: var(--primary);
      text-align: center;
      margin: 20px 0;
      text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .traits {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin: 25px 0;
      flex-wrap: wrap;
    }
    
    .trait {
      background: white;
      padding: 10px 20px;
      border-radius: 30px;
      font-size: 1rem;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);
      border: 1px solid #e0e0ff;
    }
    
    .result-section {
      background: white;
      border-radius: 15px;
      padding: 25px;
      margin: 25px 0;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
      border: 1px solid #eee;
    }
    
    .result-section h3 {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .result-section h3 i {
      color: var(--accent);
    }
    
    .accuracy-meter {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin: 20px 0;
    }
    
    .meter-point {
      width: 35px;
      height: 12px;
      background: #e0e0e0;
      border-radius: 6px;
      transition: all 0.3s ease;
      cursor: pointer;
    }
    
    .meter-point:hover {
      transform: translateY(-3px);
    }
    
    .meter-point.active {
      background: var(--accent);
      box-shadow: 0 3px 8px rgba(255, 122, 138, 0.3);
    }
    
    .export-buttons {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 30px 0;
      flex-wrap: wrap;
    }
    
    .export-btn {
      padding: 14px 28px;
      border-radius: 50px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 2px solid transparent;
    }
    
    .export-btn:hover {
      transform: translateY(-3px);
      opacity: 0.9;
    }
    
    .image-export {
      background: linear-gradient(135deg, #ff7a8a, #ff9a9e);
      color: white;
    }
    
    .doc-export {
      background: linear-gradient(135deg, #3498db, #2ecc71);
      color: white;
    }
    
    /* 响应式设计 */
    @media (max-width: 768px) {
      .container {
        border-radius: 15px;
      }
      
      header {
        padding: 30px 20px;
      }
      
      h1 {
        font-size: 2.2rem;
      }
      
      .options-container {
        gap: 20px;
      }
      
      .option-card {
        width: 100%;
        max-width: 350px;
      }
      
      .payment-btn {
        width: 160px;
        height: 160px;
      }
      
      .personality-type {
        font-size: 2.5rem;
      }
      
      .export-buttons {
        flex-direction: column;
        align-items: center;
      }
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    .pulse {
      animation: pulse 2s infinite;
    }
    
    .fade-in {
      animation: fadeIn 0.8s ease;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1><i class="fas fa-brain"></i> 专业性格测试系统</h1>
      <div class="intro-text">
        <p>基于国际心理学标准与大数据分析的权威性格测评</p>
        <p>全面解析您的性格特征，提供专业人生指导建议</p>
      </div>
    </header>
    
    <!-- 选择测试题量页面 -->
    <div id="test-options" class="page">
      <h2>选择测试题量</h2>
      <p>不同的题量将提供不同深度的分析报告，请根据您的需求选择</p>
      
      <div class="options-container">
        <div class="option-card" id="option-40">
          <div class="icon">
            <i class="fas fa-file-alt"></i>
          </div>
          <h3>40题标准版</h3>
          <p>约10-15分钟完成</p>
          <ul>
            <li>基础性格分析</li>
            <li>核心特质评估</li>
            <li>基本建议指导</li>
            <li>快速了解自我</li>
          </ul>
          <button class="secondary">开始测试</button>
        </div>
        
        <div class="option-card" id="option-60">
          <div class="icon">
            <i class="fas fa-file-medical"></i>
          </div>
          <h3>60题专业版</h3>
          <p>约15-20分钟完成</p>
          <ul>
            <li>全面性格剖析</li>
            <li>详细特质分析</li>
            <li>多维人生指导</li>
            <li>专属发展建议</li>
            <li>深度自我认知</li>
          </ul>
          <button class="secondary">开始测试</button>
        </div>
      </div>
      
      <p class="fade-in" style="max-width: 600px; margin: 20px auto; font-style: italic; color: #6a5acd;">
        <i class="fas fa-lightbulb"></i> 提示：专业版提供更全面的分析报告，包含婚姻、职场、健康、财运等多维度指导
      </p>
    </div>
    
    <!-- 测试页面 -->
    <div id="quiz-container" class="page hidden">
      <div class="progress-container">
        <div class="progress-bar">
          <div class="progress-fill" id="progress-fill"></div>
        </div>
        <div class="progress-info">
          <span id="progress-text">问题 1/40</span>
          <span class="timer"><i class="fas fa-clock"></i> 用时: <span id="timer">00:00</span></span>
        </div>
      </div>
      
      <div id="quiz-form" class="question-container">
        <!-- 问题将通过JS动态生成 -->
      </div>
      
      <button id="submit-btn">提交测试</button>
    </div>
    
    <!-- 支付页面 -->
    <div id="payment-container" class="page hidden">
      <h2><i class="fas fa-lock"></i> 解锁完整报告</h2>
      <p>您已完成测试，支付后即可查看专业的性格分析报告</p>
      
      <div class="payment-options">
        <div class="payment-btn wechat" id="wechat-pay">
          <i class="fab fa-weixin"></i>
          <span>微信支付</span>
        </div>
        <div class="payment-btn alipay" id="alipay-pay">
          <i class="fab fa-alipay"></i>
          <span>支付宝支付</span>
        </div>
      </div>
      
      <!-- 微信支付二维码 -->
      <div id="wechat-qrcode" class="qrcode-container hidden">
        <div class="qrcode-title">微信支付</div>
        <div class="qrcode-image">
          <!-- 请替换为您的微信支付二维码图片 -->
          <img src="https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=weixin://wxpay/bizpayurl?pr=your_wechat_payment_code" alt="微信支付二维码">
        </div>
        <p class="qrcode-instruction">请长按识别二维码完成支付</p>
      </div>
      
      <!-- 支付宝支付二维码 -->
      <div id="alipay-qrcode" class="qrcode-container hidden">
        <div class="qrcode-title">支付宝支付</div>
        <div class="qrcode-image">
          <!-- 请替换为您的支付宝支付二维码图片 -->
          <img src="https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=alipays://platformapi/startapp?appId=your_alipay_code" alt="支付宝支付二维码">
        </div>
        <p class="qrcode-instruction">请长按识别二维码完成支付</p>
      </div>
      
      <div class="payment-complete">
        <button id="payment-complete" class="secondary">已完成支付</button>
      </div>
    </div>
    
    <!-- 结果页面 -->
    <div id="result-container" class="page hidden">
      <div class="result-header">
        <h2><i class="fas fa-chart-bar"></i> 您的性格分析报告</h2>
        <p>基于您的回答，我们进行了专业的心理学分析</p>
        <p class="timer">完成时间: <span id="result-timer">00:00</span> | 测试日期: <span id="test-date">2023-10-15</span></p>
      </div>
      
      <div class="personality-card">
        <h3>您的性格类型</h3>
        <div class="personality-type" id="personality-type">ISTJ</div>
        
        <div class="traits">
          <span class="trait">务实可靠</span>
          <span class="trait">注重细节</span>
          <span class="trait">有条理</span>
          <span class="trait">负责任</span>
          <span class="trait">忠诚坚定</span>
        </div>
        
        <p style="text-align: center; font-style: italic; color: #6a5acd;">
          "秩序守护者 - 以责任和效率构建世界的坚实支柱"
        </p>
      </div>
      
      <div class="result-section">
        <h3><i class="fas fa-heart"></i> 婚姻情感</h3>
        <p>在婚姻关系中，您是一个可靠而忠诚的伴侣。您重视承诺和稳定性，会为家庭提供坚实的物质和情感支持。您倾向于通过实际行动表达爱意，而不是浪漫的言语。您需要伴侣理解您对秩序和计划的需求，同时也要给您一定的个人空间来处理问题。在长期关系中，您会是一个值得信赖的伴侣，但需要注意表达情感和适应变化的能力。</p>
      </div>
      
      <div class="result-section">
        <h3><i class="fas fa-briefcase"></i> 职场发展</h3>
        <p>您在职场上表现出色，特别擅长需要精确性、条理性和责任感的工作。项目管理、财务分析、工程技术和行政管理都是适合您的领域。您的优势在于能够系统化地解决问题，严格遵守流程，并在压力下保持高效。建议您：1) 在团队中发挥组织协调能力；2) 学习灵活应对计划外的变化；3) 培养战略思维，不要过度关注细节而忽略大局。您的职业发展路径应该是成为某个专业领域的专家或管理者。</p>
      </div>
      
      <div class="result-section">
        <h3><i class="fas fa-home"></i> 生活方式</h3>
        <p>您偏好有序、可预测的生活方式。日常生活中，您会制定详细的计划并按部就班地执行。您的家居环境通常整洁有序，每样物品都有固定位置。在休闲时间，您更喜欢有明确目标和规则的活动，如棋类游戏、徒步旅行或手工制作。您重视传统和惯例，节假日往往有固定的庆祝方式。为了生活平衡，建议您偶尔尝试一些自发性活动，培养至少一个创造性的爱好。</p>
      </div>
      
      <div class="result-section">
        <h3><i class="fas fa-heartbeat"></i> 健康管理</h3>
        <p>您的健康优势在于自律性和坚持能力。您可能已经有规律的锻炼计划和饮食安排。需要注意的压力源包括：过度工作、计划被打乱、环境混乱。常见健康风险：因长期压抑情绪导致的消化系统问题、肌肉紧张和失眠。健康建议：1) 每周安排2-3次有氧运动；2) 练习冥想提高专注力；3) 定期进行身体检查；4) 培养表达情感的习惯。您的健康箴言："规律是最好的医生"。</p>
      </div>
      
      <div class="result-section">
        <h3><i class="fas fa-coins"></i> 财运分析</h3>
        <p>在财务管理方面，您是谨慎而保守的类型。您倾向于详细规划收支，有明确的储蓄目标和应急基金。投资偏好低风险产品，如定期存款、国债和蓝筹股。您的财富优势在于：1) 强大的预算执行能力；2) 对细节的关注避免财务漏洞；3) 长期坚持的储蓄习惯。建议：在保持主要资金安全的同时，可以分配10-15%的资金尝试中等风险投资；考虑通过专业认证提升收入潜力；建立更全面的退休规划。</p>
      </div>
      
      <div class="result-section">
        <h3><i class="fas fa-lightbulb"></i> 人生建议</h3>
        <p>基于您的性格特质，我们为您提供以下发展建议：</p>
        <ul style="text-align: left; margin: 15px 0 15px 40px;">
          <li>在保持可靠性的同时，培养应对变化的灵活性</li>
          <li>学习表达情感，让亲密关系更加丰富</li>
          <li>定期审视长期目标，避免陷入日常细节</li>
          <li>为创意和自发性留出空间，平衡生活</li>
          <li>建立跨领域人际关系网络，拓展视野</li>
          <li>每年学习一项新技能，保持成长心态</li>
        </ul>
        <p style="margin-top: 15px; font-style: italic; color: #6a5acd;">
          "真正的智慧在于知道何时坚持原则，何时灵活变通"
        </p>
      </div>
      
      <div class="export-buttons">
        <div class="export-btn image-export" id="export-image">
          <i class="fas fa-image"></i>
          <span>导出为图片</span>
        </div>
        <div class="export-btn doc-export" id="export-doc">
          <i class="fas fa-file-word"></i>
          <span>导出为Word文档</span>
        </div>
      </div>
    </div>
  </div>

  <script>
    // 60道测试题目
    const questions = [
      { question: "在社交场合中，你通常如何表现？", options: ['更倾向于独处，享受安静', '更倾向于社交，主动交流'], dimension: 'EI' },
      { question: "当遇到挑战时，你通常会：", options: ['通过逻辑分析解决', '依赖情感和直觉'], dimension: 'TF' },
      { question: "你更倾向于相信：", options: ['具体的事实和数据', '潜在的可能性和意义'], dimension: 'SN' },
      { question: "你更喜欢哪种工作方式？", options: ['有计划的、有组织的', '灵活的、随性的'], dimension: 'JP' },
      { question: "在做决定时，你更注重：", options: ['客观标准和原则', '人际关系和影响'], dimension: 'TF' },
      { question: "你更愿意被描述为：", options: ['实际和务实', '富有想象力和创新'], dimension: 'SN' },
      { question: "在空闲时间，你更喜欢：", options: ['与朋友聚会', '独自阅读或思考'], dimension: 'EI' },
      { question: "你更擅长：", options: ['按部就班完成任务', '即兴发挥和适应变化'], dimension: 'JP' },
      { question: "你更倾向于关注：", options: ['当前的现实情况', '未来的可能性'], dimension: 'SN' },
      { question: "当别人情绪低落时，你通常会：", options: ['提供实际的解决方案', '给予情感支持和安慰'], dimension: 'TF' },
      // 更多题目...
    ];

    // 8种性格类型详细结果
    const personalityResults = {
      "ISTJ": {
        type: "ISTJ",
        traits: ["务实可靠", "注重细节", "有条理", "负责任", "忠诚坚定"],
        description: "秩序守护者 - 以责任和效率构建世界的坚实支柱",
        sections: {
          marriage: "在婚姻关系中，您是一个可靠而忠诚的伴侣...",
          career: "您在职场上表现出色，特别擅长需要精确性、条理性和责任感的工作...",
          lifestyle: "您偏好有序、可预测的生活方式...",
          health: "您的健康优势在于自律性和坚持能力...",
          finance: "在财务管理方面，您是谨慎而保守的类型...",
          advice: "基于您的性格特质，我们为您提供以下发展建议..."
        }
      },
      // 其他性格类型...
    };

    let currentQuestion = 0;
    let answers = [];
    let testQuestionCount = 40; // 默认40题
    let startTime = null;
    let timerInterval = null;
    let personalityScores = {
      E: 0, I: 0,
      S: 0, N: 0,
      T: 0, F: 0,
      J: 0, P: 0
    };

    // 初始化测试
    document.addEventListener('DOMContentLoaded', () => {
      // 设置当前日期
      const now = new Date();
      document.getElementById('test-date').textContent = 
        `${now.getFullYear()}-${(now.getMonth()+1).toString().padStart(2, '0')}-${now.getDate().toString().padStart(2, '0')}`;
      
      // 题量选择事件
      document.getElementById('option-40').addEventListener('click', () => {
        testQuestionCount = 40;
        startTest();
      });
      
      document.getElementById('option-60').addEventListener('click', () => {
        testQuestionCount = 60;
        startTest();
      });
      
      // 提交测试按钮事件
      document.getElementById('submit-btn').addEventListener('click', submitQuiz);
      
      // 支付按钮事件
      document.getElementById('wechat-pay').addEventListener('click', () => showQRCode('wechat'));
      document.getElementById('alipay-pay').addEventListener('click', () => showQRCode('alipay'));
      
      // 支付完成按钮事件
      document.getElementById('payment-complete').addEventListener('click', processPayment);
      
      // 导出按钮事件
      document.getElementById('export-image').addEventListener('click', exportAsImage);
      document.getElementById('export-doc').addEventListener('click', exportAsDoc);
    });

    // 开始测试
    function startTest() {
      document.getElementById('test-options').classList.add('hidden');
      document.getElementById('quiz-container').classList.remove('hidden');
      
      // 重置状态
      currentQuestion = 0;
      answers = [];
      personalityScores = {E:0, I:0, S:0, N:0, T:0, F:0, J:0, P:0};
      
      // 开始计时
      startTime = new Date();
      updateTimer();
      timerInterval = setInterval(updateTimer, 1000);
      
      // 加载第一题
      loadQuestion();
      updateProgress();
    }

    // 更新计时器
    function updateTimer() {
      if (!startTime) return;
      
      const now = new Date();
      const diff = Math.floor((now - startTime) / 1000);
      const minutes = Math.floor(diff / 60).toString().padStart(2, '0');
      const seconds = (diff % 60).toString().padStart(2, '0');
      
      document.getElementById('timer').textContent = `${minutes}:${seconds}`;
      document.getElementById('result-timer').textContent = `${minutes}:${seconds}`;
    }

    // 加载当前问题
    function loadQuestion() {
      const quizForm = document.getElementById('quiz-form');
      quizForm.innerHTML = '';
      
      const q = questions[currentQuestion];
      const questionHTML = `
        <div class="question">
          <p>${currentQuestion + 1}. ${q.question}</p>
          <div class="options">
            ${q.options.map((option, index) => `
              <div class="option" data-index="${index}">
                <input type="radio" name="q${currentQuestion}" id="q${currentQuestion}-${index}" value="${index}">
                <label for="q${currentQuestion}-${index}">${option}</label>
              </div>
            `).join('')}
          </div>
        </div>
      `;
      
      quizForm.innerHTML = questionHTML;
      
      // 添加选项选择事件
      document.querySelectorAll('.option').forEach(option => {
        option.addEventListener('click', function() {
          // 移除其他选项的选中状态
          this.parentNode.querySelectorAll('.option').forEach(opt => {
            opt.classList.remove('selected');
          });
          
          // 设置当前选项为选中状态
          this.classList.add('selected');
          
          // 选中单选按钮
          const radio = this.querySelector('input[type="radio"]');
          radio.checked = true;
          
          // 保存答案
          answers[currentQuestion] = parseInt(this.dataset.index);
          
          // 自动进入下一题（如果不是最后一题）
          setTimeout(() => {
            if (currentQuestion < testQuestionCount - 1) {
              currentQuestion++;
              loadQuestion();
              updateProgress();
            }
          }, 500);
        });
      });
    }

    // 更新进度条
    function updateProgress() {
      const progress = ((currentQuestion + 1) / testQuestionCount) * 100;
      document.getElementById('progress-fill').style.width = `${progress}%`;
      document.getElementById('progress-text').textContent = `问题 ${currentQuestion + 1}/${testQuestionCount}`;
    }

    // 提交测试
    function submitQuiz() {
      // 确保所有问题都已回答
      if (answers.length < testQuestionCount) {
        alert(`请完成所有${testQuestionCount}道问题后再提交！`);
        return;
      }
      
      // 停止计时
      clearInterval(timerInterval);
      updateTimer();
      
      // 计算性格类型
      calculatePersonality();
      
      // 显示支付页面
      document.getElementById('quiz-container').classList.add('hidden');
      document.getElementById('payment-container').classList.remove('hidden');
    }

    // 计算性格类型
    function calculatePersonality() {
      // 统计每个维度的分数
      for (let i = 0; i < testQuestionCount; i++) {
        const q = questions[i];
        const optionIndex = answers[i];
        
        // 每个维度的第一个字母对应选项0，第二个字母对应选项1
        if (optionIndex === 0) {
          personalityScores[q.dimension[0]]++;
        } else if (optionIndex === 1) {
          personalityScores[q.dimension[1]]++;
        }
      }
      
      // 确定性格类型
      const ei = personalityScores.E > personalityScores.I ? 'E' : 'I';
      const sn = personalityScores.S > personalityScores.N ? 'S' : 'N';
      const tf = personalityScores.T > personalityScores.F ? 'T' : 'F';
      const jp = personalityScores.J > personalityScores.P ? 'J' : 'P';
      
      const personalityType = ei + sn + tf + jp;
      
      // 保存结果
      localStorage.setItem('personalityResult', personalityType);
    }

    // 显示支付二维码
    function showQRCode(type) {
      // 隐藏所有二维码容器
      document.getElementById('wechat-qrcode').classList.add('hidden');
      document.getElementById('alipay-qrcode').classList.add('hidden');
      
      // 显示选定的二维码
      if (type === 'wechat') {
        document.getElementById('wechat-qrcode').classList.remove('hidden');
      } else {
        document.getElementById('alipay-qrcode').classList.remove('hidden');
      }
      
      // 滚动到二维码位置
      document.querySelector('.qrcode-container:not(.hidden)').scrollIntoView({ 
        behavior: 'smooth' 
      });
    }

    // 处理支付完成
    function processPayment() {
      // 显示结果页面
      document.getElementById('payment-container').classList.add('hidden');
      showResults();
    }

    // 显示结果
    function showResults() {
      const resultContainer = document.getElementById('result-container');
      resultContainer.classList.remove('hidden');
      
      const personalityType = localStorage.getItem('personalityResult') || 'ISTJ';
      const result = personalityResults[personalityType];
      
      document.getElementById('personality-type').textContent = personalityType;
      
      // 更新性格特质
      const traitsContainer = document.querySelector('.traits');
      traitsContainer.innerHTML = '';
      result.traits.forEach(trait => {
        traitsContainer.innerHTML += `<span class="trait">${trait}</span>`;
      });
      
      // 滚动到结果顶部
      resultContainer.scrollIntoView({ behavior: 'smooth' });
    }

    // 导出为图片
    function exportAsImage() {
      const resultContainer = document.getElementById('result-container');
      
      // 使用html2canvas将结果转换为图片
      html2canvas(resultContainer, {
        scale: 2, // 提高导出图片质量
        backgroundColor: "#f8f9ff"
      }).then(canvas => {
        // 创建下载链接
        const link = document.createElement('a');
        link.download = '性格测试报告_' + new Date().toISOString().slice(0, 10) + '.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
        
        // 显示成功提示
        showExportSuccess('图片已成功导出！');
      }).catch(err => {
        console.error('导出图片失败:', err);
        alert('导出图片失败，请重试或使用其他导出方式');
      });
    }

    // 导出为Word文档
    function exportAsDoc() {
      const { Document, Paragraph, TextRun, HeadingLevel, AlignmentType } = docx;
      
      // 创建文档内容
      const doc = new Document({
        sections: [{
          properties: {},
          children: [
            new Paragraph({
              text: "专业性格测试报告",
              heading: HeadingLevel.HEADING_1,
              alignment: AlignmentType.CENTER,
              spacing: {
                after: 200
              }
            }),
            new Paragraph({
              children: [
                new TextRun({
                  text: "测试日期: ",
                  bold: true
                }),
                new TextRun(document.getElementById('test-date').textContent)
              ]
            }),
            new Paragraph({
              children: [
                new TextRun({
                  text: "完成时间: ",
                  bold: true
                }),
                new TextRun(document.getElementById('result-timer').textContent)
              ]
            }),
            new Paragraph({
              text: "您的性格类型",
              heading: HeadingLevel.HEADING_2,
              spacing: {
                before: 300,
                after: 150
              }
            }),
            new Paragraph({
              text: document.getElementById('personality-type').textContent,
              bold: true,
              size: 36,
              alignment: AlignmentType.CENTER,
              spacing: {
                after: 200
              }
            }),
            // 更多内容...
            new Paragraph({
              text: "© 2023 专业性格测试系统 - 保留所有权利",
              alignment: AlignmentType.CENTER,
              spacing: {
                before: 600
              }
            })
          ]
        }]
      });
      
      // 导出文档
      docx.Packer.toBlob(doc).then(blob => {
        // 创建下载链接
        const link = document.createElement('a');
        link.download = '性格测试报告_' + new Date().toISOString().slice(0, 10) + '.docx';
        link.href = URL.createObjectURL(blob);
        link.click();
        
        // 释放对象URL
        setTimeout(() => URL.revokeObjectURL(link.href), 100);
        
        // 显示成功提示
        showExportSuccess('Word文档已成功导出！');
      });
    }

    // 显示导出成功提示
    function showExportSuccess(message) {
      const notification = document.createElement('div');
      notification.textContent = message;
      notification.style.cssText = `
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: #27ae60;
        color: white;
        padding: 15px 25px;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        z-index: 1000;
        animation: fadeInOut 3s ease;
      `;
      
      document.body.appendChild(notification);
      
      // 3秒后移除提示
      setTimeout(() => {
        notification.style.opacity = '0';
        setTimeout(() => document.body.removeChild(notification), 300);
      }, 2700);
    }

    // 添加CSS动画
    const style = document.createElement('style');
    style.textContent = `
      @keyframes fadeInOut {
        0% { opacity: 0; transform: translateY(20px); }
        20% { opacity: 1; transform: translateY(0); }
        80% { opacity: 1; transform: translateY(0); }
        100% { opacity: 0; transform: translateY(20px); }
      }
    `;
    document.head.appendChild(style);
  </script>
</body>
</html>
